***
###  The calculation of the sixteen climatic characteristics for all of the weather stations included in the transect
#### Iljin Victor, 13.10.2016
***
  + download scripts with calculation functions
  + reading climate data of the weather station
  + cleaning missing values 
  + The calculation of climatic parameters
  + Record results in a spreadsheet 

```{r begin}
source("https://raw.githubusercontent.com/tmeits/24516/master/transect/set_work_dir.R")
Rmd2R("transect.Rmd", "transect.R")
source("transect.R")
# downloadable list of files containing climatic measurements
altai.files <- list.files(path = "cli/altai")
lena.files <- list.files(path = "cli/lena")
north.files <- list.files(path = "cli/north")
yenisei.files <- list.files(path = "cli/yenisei")

all.files <- sort(c(altai.files, lena.files, north.files, yenisei.files))
all.files
cli2par <- function(path, listFiles, info = TRUE) {
    for (i in 1:length(listFiles)) {
        D <- read.csv(paste0(path, listFiles[i]), header = FALSE, sep = "", dec = ".")
        # The names of each column assign
        D <- setNames(D, c("Day", "Month", "Year", "PRECIP", "TMEAN"))
        if (info == TRUE) {
            print("***************************************************************")
            print(paste0(path, listFiles[i]))
            # Delete the rows contains the number -9999
            na <- abs(length(D[D$PRECIP != -9999, ][, 1]) - length(D[, 1]))
            cat("The number of deleted rows by column precipitation=", na, "\n")
            D <- D[D$PRECIP != -9999, ]
            na <- abs(length(D[D$TMEAN != -9999, ][, 1]) - length(D[, 1]))
            cat("The number of deleted rows by column temp=", na, "\n")
            D <- D[D$TMEAN != -9999, ]
            print(tail(D))
            print(str(D))
            print(summary(D[4:5]))
            print("***************************************************************")
        } else {
            # Delete the rows contains the number -9999
            na <- abs(length(D[D$PRECIP != -9999, ][, 1]) - length(D[, 1]))
            D <- D[D$PRECIP != -9999, ]
            na <- abs(length(D[D$TMEAN != -9999, ][, 1]) - length(D[, 1]))
            D <- D[D$TMEAN != -9999, ]
        }
        # get rid of all observations with missing data
        D <- na.omit(D)
        endYear <- D[length(D[, 3]), 3]
        startYear <- D[1, 3]
        if (info == TRUE) {
            require(pracma)
            tic()
            E <- eval16CliPars("23365", D, D, startYear, endYear)
            str(E)
            head(E)
            summary(E)
            toc()
        } else {
            E <- eval16CliPars("23365", D, D, startYear, endYear)
        }
        # WriteXLSX
        Sys.setenv(R_ZIPCMD = paste0(path, "/zip.exe"))  ## path to zip.exe
        require(openxlsx)
        head(E)
        openxlsx::write.xlsx(E, file = paste0(path,"/cli2par/",listFiles[i],".xlsx"))
        
    }
}

cli2par(paste0(mm_path, "/cli/altai/"), altai.files[1], info = TRUE)
# traceback()
#  Reading a specific year, specific weather stations
getCliStation <- function(path, files) {
    D <- read.csv(paste0(path, files), header = FALSE, sep = "", dec = ".")
    D <- setNames(D, c("Day", "Month", "Year", "PRECIP", "TMEAN"))
    return(D)
}
SA472 <- getCliStation(paste0(mm_path, "/cli/altai/"), altai.files[4])
numberObservation(SA472, 1972)
numberObservation(SA472, 1948)
# http://adv-r.had.co.nz/Exceptions-Debugging.html#debugging-techniques


```











